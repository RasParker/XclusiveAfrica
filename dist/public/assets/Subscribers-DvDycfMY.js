import{i as O,j as e,A as S,m as C,n as T,l as k,B as v,M as F,I as Q,X as R,o as N,a as Y,u as H,b as X,w as G,r as x,x as Z,C as p,g,d as ee,e as se,f as te}from"./index-DnjzDop3.js";import{T as ae,a as re,b}from"./tabs-Tn3DyEKi.js";import{C as ne}from"./calendar-We5RV4OF.js";import{S as le,a as ie,b as ce,c as oe,d as U}from"./select-BgAE-lOE.js";import{S as A}from"./search-tyvWbnyU.js";import"./chevron-up-CD9nw7va.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=O("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),me=({subscriber:s,onMessage:n})=>{var o,h,r,u;return e.jsxs("div",{className:"p-4 rounded-lg border border-border/50 hover:border-primary/50 transition-colors bg-card",children:[e.jsxs("div",{className:"space-y-4 md:hidden",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(S,{className:"h-12 w-12",children:[e.jsx(C,{src:s.avatar?s.avatar.startsWith("/uploads/")?s.avatar:`/uploads/${s.avatar}`:null,alt:s.username||"User"}),e.jsx(T,{className:"bg-gradient-primary text-primary-foreground",children:((h=(o=s.username)==null?void 0:o.charAt(0))==null?void 0:h.toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground text-base truncate",children:s.username||"Unknown User"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Subscriber since ",s.joined||new Date(s.created_at).toLocaleDateString()]})]}),e.jsx(k,{variant:s.tier==="Premium Content"?"default":"outline",className:"shrink-0",children:s.tier})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsxs("span",{children:["Joined ",s.joined]})]}),e.jsx("span",{className:`font-medium ${s.status==="Active"?"text-green-600":"text-yellow-600"}`,children:s.status})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>n(s.username||s.display_name||"Unknown User"),className:"w-full",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Send Message"]})]}),e.jsxs("div",{className:"hidden md:flex md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(S,{className:"h-12 w-12",children:[e.jsx(C,{src:s.avatar?s.avatar.startsWith("/uploads/")?s.avatar:`/uploads/${s.avatar}`:null,alt:s.username||"User"}),e.jsx(T,{className:"bg-gradient-primary text-primary-foreground",children:((u=(r=s.username)==null?void 0:r.charAt(0))==null?void 0:u.toUpperCase())||"U"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:s.username||"Unknown User"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Subscriber since ",s.joined||new Date(s.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{variant:s.tier==="Premium Content"?"default":"outline",children:s.tier}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Joined ",s.joined]}),e.jsx("p",{className:`text-xs ${s.status==="Active"?"text-green-600":"text-yellow-600"}`,children:s.status})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>n(s.username||s.display_name||"Unknown User"),children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Send Message"]})]})]})]})},xe=({searchTerm:s,selectedTier:n,onSearchChange:o,onSearch:h,onFilterChange:r,onReset:u,tiers:j})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col gap-3 sm:flex-row",children:e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(Q,{placeholder:"Search by username or email...",value:s,onChange:c=>o(c.target.value),onKeyPress:c=>c.key==="Enter"&&h(),className:"flex-1"}),e.jsxs(v,{onClick:h,size:"sm",className:"shrink-0",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline ml-2",children:"Search"})]})]})}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(de,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs(le,{value:n,onValueChange:r,children:[e.jsx(ie,{className:"flex-1 sm:w-48",children:e.jsx(ce,{placeholder:"Filter by tier"})}),e.jsxs(oe,{children:[e.jsx(U,{value:"all",children:"All Tiers"}),j.map(c=>e.jsx(U,{value:c.name,children:c.name},c.id))]})]})]}),e.jsxs(v,{variant:"outline",onClick:u,size:"sm",className:"shrink-0",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Clear"})]})]})]}),he=({hasFilters:s,searchTerm:n,selectedTier:o})=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-muted/50 flex items-center justify-center",children:s?e.jsx(A,{className:"w-8 h-8 text-muted-foreground"}):e.jsx(N,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:s?"No subscribers found":"No subscribers yet"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md mx-auto",children:s?e.jsxs(e.Fragment,{children:["Try adjusting your search or filter criteria.",n&&e.jsxs("span",{className:"block mt-1",children:['No results for "',e.jsx("span",{className:"font-medium",children:n}),'"']}),o!=="all"&&e.jsxs("span",{className:"block mt-1",children:["in ",e.jsx("span",{className:"font-medium",children:o})]})]}):"Your subscribers will appear here once they start following you"})]}),ve=()=>{const{toast:s}=Y(),{user:n}=H(),o=X(),h=G(),[r,u]=x.useState(""),[j,c]=x.useState("all"),[l,w]=x.useState([]),[f,d]=x.useState([]),[D,y]=x.useState(!0),[E,L]=x.useState("all"),[$,M]=x.useState([]);x.useEffect(()=>{(async()=>{if(n)try{y(!0);const a=await fetch(`/api/creators/${n.id}/subscribers`);if(a.ok){const m=await a.json();console.log("Fetched subscribers:",m),w(m),d(m)}else console.error("Failed to fetch subscribers"),w([]),d([])}catch(a){console.error("Error fetching subscribers:",a),w([]),d([])}finally{y(!1)}})(),(async()=>{if(n)try{const a=await fetch(`/api/creators/${n.id}/tiers`);if(a.ok){const m=await a.json();M(m)}}catch(a){console.error("Error fetching tiers:",a)}})()},[n]);const _=()=>{if(!r.trim()){d(l);return}const t=l.filter(i=>{var a,m;return((a=i.username)==null?void 0:a.toLowerCase().includes(r.toLowerCase()))||((m=i.email)==null?void 0:m.toLowerCase().includes(r.toLowerCase()))});d(t),s({title:"Search completed",description:`Found ${t.length} subscriber(s) matching "${r}"`})},I=t=>{if(c(t),t==="all")d(l);else{const i=l.filter(a=>a.tier_name===t);d(i)}s({title:"Filter applied",description:t==="all"?"Showing all subscribers":`Filtered by ${t}`})},P=Z({mutationFn:async t=>{const i=await fetch("/api/conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({otherUserId:parseInt(t)})});if(!i.ok)throw new Error("Failed to create conversation");return i.json()},onSuccess:t=>{h.invalidateQueries({queryKey:["/api/conversations"]}),o("/creator/messages"),s({title:"Conversation started",description:"You can now send messages to this subscriber."})},onError:()=>{s({title:"Error",description:"Failed to start conversation. Please try again.",variant:"destructive"})}}),W=t=>{const i=l.find(a=>a.username===t);i?P.mutate(i.fan_id):s({title:"Error",description:"Could not find subscriber information.",variant:"destructive"})},z=()=>{u(""),c("all"),d(l),s({title:"Filters cleared",description:"Showing all subscribers"})},q=()=>l.filter(t=>new Date(t.created_at)>new Date(Date.now()-30*24*60*60*1e3)),B=()=>l.slice(0,5),J=l.filter(t=>t.status==="active").length,V=l.filter(t=>new Date(t.created_at)>new Date(Date.now()-30*24*60*60*1e3)).length,K=r.trim()!==""||j!=="all";return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8 text-center sm:text-left",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2 flex items-center gap-2 justify-center sm:justify-start",children:"Subscribers"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Manage and connect with your subscriber base"})]}),D?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading subscribers..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-6 sm:mb-8",children:[e.jsx(p,{className:"bg-gradient-card border-border/50",children:e.jsx(g,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:"Total Subscribers"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-foreground",children:l.length})]}),e.jsx(N,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary",strokeWidth:1})]})})}),e.jsx(p,{className:"bg-gradient-card border-border/50",children:e.jsx(g,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:"Active"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-foreground",children:J})]}),e.jsx(N,{className:"h-6 w-6 sm:h-8 sm:w-8 text-accent",strokeWidth:1})]})})}),e.jsx(p,{className:"bg-gradient-card border-border/50",children:e.jsx(g,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-muted-foreground",children:"This Month"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-foreground",children:V})]}),e.jsx(N,{className:"h-6 w-6 sm:h-8 sm:w-8 text-success",strokeWidth:1})]})})})]}),e.jsx("div",{className:"pb-safe px-4 sm:px-6",children:e.jsxs(ae,{value:E,onValueChange:L,className:"space-y-6",children:[e.jsxs(re,{className:"mb-6 justify-center sm:justify-start",children:[e.jsxs(b,{value:"all",children:["All Subs",e.jsx("span",{className:"ml-2 text-xs opacity-70",children:l.length})]}),e.jsxs(b,{value:"new",children:["New This Month",e.jsx("span",{className:"ml-2 text-xs opacity-70",children:q().length})]}),e.jsxs(b,{value:"top",children:["Top Supporters",e.jsx("span",{className:"ml-2 text-xs opacity-70",children:B().length})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(xe,{searchTerm:r,selectedTier:j,onSearchChange:u,onSearch:_,onFilterChange:I,onReset:z,tiers:$})}),e.jsxs(p,{className:"bg-gradient-card border-border/50",children:[e.jsxs(ee,{children:[e.jsx(se,{className:"text-lg sm:text-xl",children:"Subscriber List"}),e.jsx(te,{className:"text-sm",children:f.length>0?e.jsxs(e.Fragment,{children:["Showing ",f.length," of ",l.length," subscriber(s)",r&&` matching "${r}"`,j!=="all"&&` in ${j}`]}):"No subscribers to display"})]}),e.jsx(g,{children:f.length>0?e.jsx("div",{className:"space-y-4",children:f.map(t=>e.jsx(me,{subscriber:t,onMessage:W},t.id))}):e.jsx(he,{hasFilters:K,searchTerm:r,selectedTier:j})})]})]})})]})]})})};export{ve as Subscribers};
