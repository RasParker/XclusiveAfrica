import{i as le,b as ie,a as ne,u as de,r as c,j as e,B as d,L as q,A as N,m as w,n as y,O as oe,C as Y,g as J,M as W,D as ce,p as me,q as he,s as xe,E as ue,G as fe,J as ge,K as be,N as ve}from"./index-DnjzDop3.js";import{E as D}from"./EdgeToEdgeContainer-kS07pzFb.js";import{C as S}from"./CommentSection-DatytXQU.js";import{C as G}from"./calendar-We5RV4OF.js";import{H as T}from"./heart-BIzJO6uv.js";import{S as A}from"./share-2-BCHyK8hT.js";import{A as pe}from"./arrow-left-DJTbtmZM.js";import"./textarea-ChWCN1Go.js";import"./select-BgAE-lOE.js";import"./chevron-up-CD9nw7va.js";import"./flag-D_PcH8BI.js";import"./send-Baqb8pKh.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=le("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),Le=()=>{var B;const f=ie(),{toast:g}=ne(),{user:h}=de(),[o,F]=c.useState([]),[P,I]=c.useState(!0),[U,K]=c.useState({});c.useState({});const[_,b]=c.useState(!1),[Q,v]=c.useState(!1),[t,x]=c.useState(null),[k,u]=c.useState(0),[X,E]=c.useState(!1),[z,H]=c.useState("grid");c.useEffect(()=>{(async()=>{try{I(!0);const r=h?`/api/feed/${h.id}`:"/api/posts",s=await fetch(r);if(s.ok){const l=await s.json();if(console.log("Fetched posts from API:",l.length),!Array.isArray(l))throw new Error("Invalid response format from API");const n=l.map(i=>{var j,O,V,R;const m=i.tier||"public";return{id:i.id.toString(),creator:{username:((j=i.creator)==null?void 0:j.username)||i.username||"Unknown",display_name:((O=i.creator)==null?void 0:O.display_name)||i.display_name||((V=i.creator)==null?void 0:V.username)||i.username||"Unknown",avatar:((R=i.creator)==null?void 0:R.avatar)||i.avatar||"",id:i.creator_id},content:i.content||i.title||"",type:i.media_type||"post",tier:m,thumbnail:i.media_urls&&i.media_urls.length>0?i.media_urls[0].startsWith("/uploads/")?i.media_urls[0]:`/uploads/${i.media_urls[0]}`:"",posted:i.created_at||new Date().toISOString(),likes:i.likes_count||0,comments:i.comments_count||0,views:i.views_count||0,liked:!1,initialComments:[],hasAccess:!0,access_type:i.access_type||"unknown"}});console.log("Total posts after filtering:",n.length),F(n)}else{const l=await s.text();throw console.error("API request failed:",s.status,l),new Error(`API request failed with status ${s.status}`)}}catch(r){console.error("Error fetching feed:",r),g({title:"Error",description:"Failed to load feed. Please try again.",variant:"destructive"})}finally{I(!1)}})()},[h,g]);const L=async a=>{if(h)try{const r=o.find(s=>s.id===a);if(!r)return;F(o.map(s=>s.id===a?{...s,liked:!s.liked,likes:s.liked?s.likes-1:s.likes+1}:s)),r.liked?await fetch(`/api/posts/${a}/like`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:h.id})}):await fetch(`/api/posts/${a}/like`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:h.id})})}catch(r){console.error("Error liking post:",r),F(o.map(s=>s.id===a?{...s,liked:!s.liked,likes:s.liked?s.likes+1:s.likes-1}:s))}},Z=a=>{K(r=>({...r,[a]:!r[a]}))},ee=()=>{E(!0)},C=(a,r)=>{F(s=>s.map(l=>l.id===a?{...l,comments:r}:l))},M=async a=>{const r=o.find(l=>l.id===a);if(!r)return;const s=`${window.location.origin}/post/${a}`;try{navigator.share&&window.innerWidth<768?(await navigator.share({title:`${r.creator.display_name}'s post`,text:r.content,url:s}),g({title:"Shared successfully",description:"Post shared via native share dialog."})):(await navigator.clipboard.writeText(s),g({title:"Link copied",description:"Post link has been copied to your clipboard."}))}catch(l){console.error("Error sharing post:",l),g({title:"Share failed",description:"Could not share post. Please try again.",variant:"destructive"})}},$=a=>{if(!a.hasAccess){f(`/creator/${a.creator.username}`);return}if(a.type==="video"&&a.thumbnail){const r=document.createElement(a.type);r.src=a.thumbnail.startsWith("/uploads/")?a.thumbnail:`/uploads/${a.thumbnail}`,r.preload="metadata",r.onloadedmetadata=()=>{if(r.videoWidth/r.videoHeight>1.2)f(`/video/${a.id}`);else{const l=o.findIndex(n=>n.id===a.id);x(a),u(l),v(!0)}},r.onerror=()=>{const s=o.findIndex(l=>l.id===a.id);x(a),u(s),v(!0)}}else{const r=o.findIndex(s=>s.id===a.id);x(a),u(r),v(!0)}},ae=()=>{v(!1),x(null),u(0),b(!1),E(!1)},te=()=>{if(k<o.length-1){const a=k+1;u(a),x(o[a]),b(!1)}},se=()=>{if(k>0){const a=k-1;u(a),x(o[a]),b(!1)}},re=(a,r=1)=>{const s=a.split(" "),l=window.innerWidth<640?10:15,n=r*l;if(s.length<=n)return{truncated:a,needsExpansion:!1};let i=s.slice(0,n).join(" ");return i.length>0&&i.length<a.length&&(i+="..."),{truncated:i,needsExpansion:!0}},p=a=>{const r=new Date(a),l=new Date().getTime()-r.getTime(),n=Math.floor(l/(1e3*60)),i=Math.floor(l/(1e3*60*60)),m=Math.floor(l/(1e3*60*60*24));return n<1?"Just now":n<60?`${n}m ago`:i<24?`${i}h ago`:m<7?`${m}d ago`:`${Math.floor(m/7)}w ago`};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"w-full bg-background -mt-16 pt-16 overflow-y-auto scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:P?e.jsx("div",{className:"space-y-0",children:[1,2,3].map(a=>e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-muted rounded-full animate-pulse"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("div",{className:"w-3/4 h-4 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"w-1/2 h-3 bg-muted rounded animate-pulse"})]})]}),e.jsx("div",{className:"w-full h-72 bg-muted rounded-xl animate-pulse mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full h-4 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"w-4/5 h-4 bg-muted rounded animate-pulse"})]})]})},a))}):o.length===0?e.jsxs("div",{className:"text-center py-20 px-6",children:[e.jsx(G,{className:"w-20 h-20 text-muted-foreground mx-auto mb-6"}),e.jsx("h3",{className:"text-2xl font-semibold mb-3",children:"No posts yet"}),e.jsx("p",{className:"text-muted-foreground mb-8 text-lg",children:"Follow some creators to see their content in your feed"}),e.jsx(d,{asChild:!0,size:"lg",className:"px-8 py-3",children:e.jsx(q,{to:"/explore",children:"Discover Creators"})})]}):e.jsx("div",{className:"space-y-4 pb-6",children:o.map((a,r)=>e.jsxs("div",{className:"w-full bg-background border-b border-border/10 overflow-hidden",children:[e.jsx("div",{className:"relative w-full aspect-video bg-black cursor-pointer transition-transform duration-200 active:scale-[0.99]",onClick:()=>$(a),style:{minHeight:"44px"},children:a.hasAccess?a.thumbnail?a.type==="video"?e.jsx("video",{src:a.thumbnail.startsWith("/uploads/")?a.thumbnail:`/uploads/${a.thumbnail}`,className:"w-full h-full object-cover",muted:!0,preload:"metadata",loading:r>3?"lazy":"eager",onError:s=>{const l=s.target;l.style.display="none";const n=l.parentElement;n&&(n.innerHTML=`<div class="w-full h-full bg-gray-800 flex items-center justify-center">
                                  <div class="text-white text-sm">Video unavailable</div>
                                </div>`)}}):e.jsx("img",{src:a.thumbnail.startsWith("/uploads/")?a.thumbnail:`/uploads/${a.thumbnail}`,alt:`${a.creator.display_name}'s post`,className:"w-full h-full object-cover",loading:r>3?"lazy":"eager",onError:s=>{const l=s.target;l.src=`https://placehold.co/800x800/6366F1/FFFFFF?text=Creator+Post+${a.id}`}}):e.jsx("img",{src:a.id==="1"?"https://placehold.co/800x800/E63946/FFFFFF?text=Creator+Post+1":a.id==="2"?"https://placehold.co/800x800/457B9D/FFFFFF?text=Creator+Post+2":a.id==="3"?"https://placehold.co/800x800/1D3557/FFFFFF?text=Creator+Post+3":`https://placehold.co/800x800/6366F1/FFFFFF?text=Creator+Post+${a.id}`,alt:`${a.creator.display_name}'s post`,className:"w-full h-full object-cover",loading:r>3?"lazy":"eager"}):e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-muted/30 to-muted/10 flex items-center justify-center relative",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-[2px]"}),e.jsxs("div",{className:"text-center z-10 p-6 space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-background/20 rounded-full flex items-center justify-center backdrop-blur-sm",children:e.jsx("svg",{className:"w-8 h-8 text-accent",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-sm font-semibold bg-background/20 text-white border border-white/20 backdrop-blur-sm",children:a.tier==="public"?"Free":`${a.tier} Content`})}),e.jsx(d,{size:"lg",onClick:s=>{s.stopPropagation(),f(`/creator/${a.creator.username}`)},className:"bg-accent hover:bg-accent/90 text-black text-sm h-12 px-8 rounded-lg font-semibold shadow-lg min-w-[120px]",style:{minHeight:"48px",minWidth:"120px"},children:"Subscribe to View"})]})]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(N,{className:"h-12 w-12 flex-shrink-0 ring-2 ring-transparent",children:[e.jsx(w,{src:a.creator.avatar?a.creator.avatar.startsWith("/uploads/")?a.creator.avatar:`/uploads/${a.creator.avatar}`:void 0,alt:a.creator.username}),e.jsx(y,{className:"text-sm bg-muted text-muted-foreground",children:(a.creator.display_name||a.creator.username||"U").charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("h4",{className:"text-base font-semibold text-foreground line-clamp-1 leading-tight",children:a.content||"Untitled Post"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium truncate",children:a.creator.display_name||a.creator.username}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-shrink-0",children:[e.jsxs("span",{children:[(a.likes_count||a.views||0).toLocaleString()," views"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:p(a.posted)})]})]})]})]}),U[a.id]&&e.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:e.jsx(S,{postId:a.id,initialComments:a.initialComments||[],onCommentCountChange:s=>C(a.id,s)})})]})]},a.id))})})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs(D,{children:[e.jsx("div",{className:"bg-gradient-to-r from-accent/10 via-primary/5 to-accent/10 border-b border-border",children:e.jsx(D,{maxWidth:"4xl",enablePadding:!0,enableTopPadding:!0,children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl sm:text-5xl font-bold text-foreground mb-4",children:"Your Feed"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto mb-6",children:"Latest content from creators you follow"}),e.jsx("div",{className:"hidden md:flex justify-center",children:e.jsxs("div",{className:"inline-flex items-center rounded-lg border border-border bg-background p-1",children:[e.jsxs(d,{variant:z==="grid"?"default":"ghost",size:"sm",onClick:()=>H("grid"),className:"h-8 px-3",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Grid"]}),e.jsxs(d,{variant:z==="single"?"default":"ghost",size:"sm",onClick:()=>H("single"),className:"h-8 px-3",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Single"]})]})})]})})}),e.jsxs(D,{maxWidth:"7xl",enablePadding:!0,className:"py-4 sm:py-6",children:[P?e.jsx("div",{className:"space-y-6",children:[1,2,3].map(a=>e.jsx(Y,{className:"bg-gradient-card border-border/50",children:e.jsxs(J,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-muted rounded-full animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-32 h-4 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"w-24 h-3 bg-muted rounded animate-pulse"})]})]}),e.jsx("div",{className:"w-full h-48 bg-muted rounded-lg animate-pulse mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full h-4 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"w-3/4 h-4 bg-muted rounded animate-pulse"})]})]})},a))}):o.length===0?e.jsxs("div",{className:"text-center py-12 px-4 sm:px-6",children:[e.jsx(G,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Follow some creators to see their content in your feed"}),e.jsx(d,{asChild:!0,children:e.jsx(q,{to:"/explore",children:"Discover Creators"})})]}):z==="grid"?e.jsx("div",{className:"w-full max-w-none px-4 py-6",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 lg:gap-6 max-w-7xl mx-auto",children:o.map((a,r)=>e.jsxs("div",{className:"group bg-card border border-border rounded-lg overflow-hidden cursor-pointer h-full flex flex-col",onClick:()=>$(a),style:{animationDelay:`${r*50}ms`},children:[e.jsx("div",{className:"relative w-full aspect-video bg-black overflow-hidden",children:a.hasAccess?a.thumbnail?a.type==="video"?e.jsx("video",{src:a.thumbnail.startsWith("/uploads/")?a.thumbnail:`/uploads/${a.thumbnail}`,className:"w-full h-full object-cover",muted:!0,preload:"metadata",loading:r>8?"lazy":"eager",onError:s=>{const l=s.target;l.style.display="none";const n=l.parentElement;n&&(n.innerHTML=`<div class="w-full h-full bg-gray-800 flex items-center justify-center">
                                  <div class="text-white text-xs">Video unavailable</div>
                                </div>`)}}):e.jsx("img",{src:a.thumbnail.startsWith("/uploads/")?a.thumbnail:`/uploads/${a.thumbnail}`,alt:`${a.creator.display_name}'s post`,className:"w-full h-full object-cover",loading:r>8?"lazy":"eager",onError:s=>{const l=s.target;l.src=`https://placehold.co/640x360/6366F1/FFFFFF?text=Creator+Post+${a.id}`}}):e.jsx("img",{src:a.id==="1"?"https://placehold.co/640x360/E63946/FFFFFF?text=Creator+Post+1":a.id==="2"?"https://placehold.co/640x360/457B9D/FFFFFF?text=Creator+Post+2":a.id==="3"?"https://placehold.co/640x360/1D3557/FFFFFF?text=Creator+Post+3":`https://placehold.co/640x360/6366F1/FFFFFF?text=Creator+Post+${a.id}`,alt:`${a.creator.display_name}'s post`,className:"w-full h-full object-cover",loading:r>8?"lazy":"eager"}):e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-muted/30 to-muted/10 flex items-center justify-center relative",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-[2px]"}),e.jsxs("div",{className:"text-center z-10 p-4 space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto bg-background/20 rounded-full flex items-center justify-center backdrop-blur-sm",children:e.jsx("svg",{className:"w-8 h-8 text-accent",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-background/20 text-white border border-white/20 backdrop-blur-sm",children:[a.tier," Content"]})}),e.jsx(d,{size:"sm",onClick:s=>{s.stopPropagation(),f(`/creator/${a.creator.username}`)},className:"bg-accent text-black text-xs px-4 py-2 rounded-lg font-medium shadow-lg",children:"Subscribe to View"})]})]})}),e.jsx("div",{className:"flex-1 flex flex-col p-3 space-y-3",children:e.jsxs("div",{className:"flex gap-3 flex-1",children:[e.jsxs(N,{className:"h-8 w-8 flex-shrink-0 ring-2 ring-transparent",children:[e.jsx(w,{src:a.creator.avatar?a.creator.avatar.startsWith("/uploads/")?a.creator.avatar:`/uploads/${a.creator.avatar}`:void 0,alt:a.creator.username}),e.jsx(y,{className:"text-xs bg-muted text-muted-foreground",children:(a.creator.display_name||a.creator.username||"U").charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground line-clamp-1 leading-snug",children:a.content||"Untitled Post"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground font-medium truncate",children:a.creator.display_name||a.creator.username}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground flex-shrink-0",children:[e.jsxs("span",{children:[(a.likes_count||a.views||0).toLocaleString()," views"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:p(a.posted)})]})]})]})]})})]},a.id))})}):e.jsx("div",{className:"max-w-5xl mx-auto space-y-8 px-4",children:o.map((a,r)=>e.jsx(Y,{className:"bg-gradient-card border-border/50 overflow-hidden",style:{animationDelay:`${r*100}ms`,animation:"fadeIn 0.6s ease-out forwards"},children:e.jsxs(J,{className:"p-0",children:[e.jsx("div",{className:"relative aspect-video bg-black cursor-pointer overflow-hidden group",onClick:()=>$(a),role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),$(a))},children:a.hasAccess?a.thumbnail?a.type==="video"?e.jsx("video",{src:a.thumbnail.startsWith("/uploads/")?a.thumbnail:`/uploads/${a.thumbnail}`,className:"w-full h-full object-cover",muted:!0,preload:"metadata",loading:r>2?"lazy":"eager",onError:s=>{const l=s.target;l.style.display="none";const n=l.parentElement;n&&(n.innerHTML=`<div class="w-full h-full bg-gray-800 flex items-center justify-center">
                                  <div class="text-white text-sm">Video unavailable</div>
                                </div>`)}}):e.jsx("img",{src:a.thumbnail.startsWith("/uploads/")?a.thumbnail:`/uploads/${a.thumbnail}`,alt:`${a.creator.display_name}'s post`,className:"w-full h-full object-cover",loading:r>2?"lazy":"eager",onError:s=>{const l=s.target;l.src=`https://placehold.co/1280x720/6366F1/FFFFFF?text=Creator+Post+${a.id}`}}):e.jsx("img",{src:a.id==="1"?"https://placehold.co/1280x720/E63946/FFFFFF?text=Creator+Post+1":a.id==="2"?"https://placehold.co/1280x720/457B9D/FFFFFF?text=Creator+Post+2":a.id==="3"?"https://placehold.co/1280x720/1D3557/FFFFFF?text=Creator+Post+3":`https://placehold.co/1280x720/6366F1/FFFFFF?text=Creator+Post+${a.id}`,alt:`${a.creator.display_name}'s post`,className:"w-full h-full object-cover",loading:r>2?"lazy":"eager"}):e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-muted/30 to-muted/10 flex items-center justify-center relative",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-[2px]"}),e.jsxs("div",{className:"text-center z-10 p-8 space-y-6",children:[e.jsx("div",{className:"w-20 h-20 mx-auto bg-background/20 rounded-full flex items-center justify-center backdrop-blur-sm",children:e.jsx("svg",{className:"w-12 h-12 text-accent",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-background/20 text-white border border-white/20 backdrop-blur-sm",children:[a.tier," Content"]})}),e.jsx(d,{size:"lg",onClick:s=>{s.stopPropagation(),f(`/creator/${a.creator.username}`)},className:"bg-accent text-black text-base h-12 px-8 rounded-lg font-semibold shadow-lg",children:"Subscribe"})]})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(N,{className:"h-12 w-12 flex-shrink-0 ring-2 ring-transparent",children:[e.jsx(w,{src:a.creator.avatar?a.creator.avatar.startsWith("/uploads/")?a.creator.avatar:`/uploads/${a.creator.avatar}`:void 0,alt:a.creator.username}),e.jsx(y,{className:"text-sm bg-muted text-muted-foreground",children:(a.creator.display_name||a.creator.username||"U").charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-foreground line-clamp-2 leading-tight",children:a.content||"Untitled Post"}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium truncate",children:a.creator.display_name||a.creator.username}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground flex-shrink-0",children:[e.jsxs("span",{children:[(a.likes_count||a.views||0).toLocaleString()," views"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:p(a.posted)})]})]})]})]}),e.jsx("div",{className:"flex items-center justify-between pt-2 border-t border-border/30",children:e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{variant:"ghost",size:"sm",className:`h-10 w-10 p-0 rounded-full ${a.liked?"text-red-500 bg-red-50":"text-muted-foreground"}`,onClick:()=>L(a.id),children:e.jsx(T,{className:`w-5 h-5 ${a.liked?"fill-current":""}`})}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:(a.likes_count||0).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full text-muted-foreground",onClick:()=>Z(a.id),children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:(a.comments_count||0).toLocaleString()})]}),e.jsx(d,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full text-muted-foreground",onClick:()=>M(a.id),children:e.jsx(A,{className:"w-5 h-5"})})]})}),U[a.id]&&e.jsx("div",{className:"mt-6 pt-4 border-t border-border animate-in slide-in-from-top-2 duration-300",children:e.jsx(S,{postId:a.id,initialComments:a.initialComments||[],onCommentCountChange:s=>C(a.id,s),isBottomSheet:!1})})]})]})},a.id))}),!P&&o.length>0&&e.jsx("div",{className:"text-center mt-8",children:e.jsx(d,{variant:"outline",children:"Load More Posts"})})]}),e.jsx(ce,{open:Q,onOpenChange:v,children:e.jsxs(me,{className:"max-w-full max-h-full w-full h-full p-0 m-0 overflow-hidden border-0 [&>button]:hidden sm:max-w-5xl sm:max-h-[95vh] sm:w-auto sm:h-auto sm:rounded-lg",children:[e.jsxs(he,{className:"sr-only",children:[e.jsxs(xe,{children:[t==null?void 0:t.type," Content"]}),e.jsxs(ue,{children:["View content from ",(B=t==null?void 0:t.creator)==null?void 0:B.display_name]})]}),t&&e.jsxs("div",{className:"relative w-full h-full bg-black sm:flex sm:h-[90vh] sm:max-h-[800px] sm:rounded-lg sm:overflow-hidden",onTouchStart:a=>{const s=a.touches[0].clientY,l=i=>{const m=i.touches[0],j=s-m.clientY;Math.abs(j)>50&&(j>0?te():se(),document.removeEventListener("touchmove",l),document.removeEventListener("touchend",n))},n=()=>{document.removeEventListener("touchmove",l),document.removeEventListener("touchend",n)};document.addEventListener("touchmove",l),document.addEventListener("touchend",n)},children:[e.jsx(d,{variant:"ghost",size:"sm",className:"absolute top-4 left-4 z-50 w-10 h-10 rounded-full text-white hover:bg-gray-800 sm:text-gray-600 sm:hover:bg-gray-200",onClick:ae,children:e.jsx(pe,{className:"w-7 h-7"})}),e.jsxs("div",{className:"relative w-full h-full bg-black sm:hidden",children:[t.thumbnail?t.type==="video"?e.jsx("div",{className:"w-full h-full bg-black flex items-center justify-center",children:e.jsx("video",{src:t.thumbnail.startsWith("/uploads/")?t.thumbnail:`/uploads/${t.thumbnail}`,className:"max-w-full max-h-full",controls:!0,autoPlay:!0,muted:!0,loop:!0,onLoadedMetadata:a=>{const r=a.target;r.videoWidth/r.videoHeight>1?(r.style.width="100%",r.style.height="auto"):(r.style.width="auto",r.style.height="100%")}},t.id)}):e.jsx("img",{src:t.thumbnail.startsWith("/uploads/")?t.thumbnail:`/uploads/${t.thumbnail}`,alt:`${t.creator.display_name}'s post`,className:"w-full h-full object-cover"}):t.id==="1"?e.jsx("img",{src:"https://placehold.co/1080x1920/E63946/FFFFFF?text=Creator+Post+1",alt:`${t.creator.display_name}'s post`,className:"w-full h-full object-cover"}):t.id==="2"?e.jsx("img",{src:"https://placehold.co/1080x1920/457B9D/FFFFFF?text=Creator+Post+2",alt:`${t.creator.display_name}'s post`,className:"w-full h-full object-cover"}):t.id==="3"?e.jsx("img",{src:"https://placehold.co/1080x1920/1D3557/FFFFFF?text=Creator+Post+3",alt:`${t.creator.display_name}'s post`,className:"w-full h-full object-cover"}):e.jsx("img",{src:`https://placehold.co/1080x1920/6366F1/FFFFFF?text=Creator+Post+${t.id}`,alt:`${t.creator.display_name}'s post`,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent pointer-events-none",children:[e.jsxs("div",{className:"absolute bottom-20 left-4 right-16 pointer-events-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs(N,{className:"h-10 w-10 border-2 border-white",children:[e.jsx(w,{src:t.creator.avatar?t.creator.avatar.startsWith("/uploads/")?t.creator.avatar:`/uploads/${t.creator.avatar}`:void 0,alt:t.creator.username}),e.jsx(y,{className:"text-black",children:(t.creator.display_name||t.creator.username||"U").charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-white text-sm drop-shadow-lg",children:["@",t.creator.username]}),e.jsx("span",{className:"text-xs text-white/80 drop-shadow-lg",children:p(t.posted)})]})]}),e.jsx("div",{className:"mb-3",children:(()=>{const{truncated:a,needsExpansion:r}=re(t.content,2);return e.jsxs("p",{className:"text-sm leading-relaxed text-white drop-shadow-lg",children:[_?t.content:e.jsxs(e.Fragment,{children:[a,r&&!_&&e.jsxs(e.Fragment,{children:["... ",e.jsx("button",{onClick:()=>b(!0),className:"text-white/80 hover:text-white font-normal underline",children:"more"})]})]}),_&&r&&e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:()=>b(!1),className:"text-white/80 hover:text-white font-normal underline",children:"less"})]})]})})()})]}),e.jsxs("div",{className:"absolute bottom-20 right-4 flex flex-col gap-4 pointer-events-auto",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(d,{variant:"ghost",size:"sm",className:`h-12 w-12 p-0 rounded-full bg-gray-900 border-2 border-gray-500 ${t.liked?"text-red-500":"text-white"}`,onClick:()=>L(t.id),children:e.jsx(T,{className:`w-6 h-6 ${t.liked?"fill-current":""}`})}),e.jsx("span",{className:"text-xs font-medium text-white drop-shadow-lg mt-1",children:t.likes})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(d,{variant:"ghost",size:"sm",className:"h-12 w-12 p-0 rounded-full bg-gray-900 border-2 border-gray-500 text-white",onClick:ee,children:e.jsx(W,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-xs font-medium text-white drop-shadow-lg mt-1",children:t.comments})]}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsx(d,{variant:"ghost",size:"sm",className:"h-12 w-12 p-0 rounded-full bg-gray-900 border-2 border-gray-500 text-white",onClick:()=>M(t.id),children:e.jsx(A,{className:"w-6 h-6"})})})]})]})]}),e.jsxs("div",{className:"hidden sm:flex w-full h-full",children:[e.jsx("div",{className:"flex-1 bg-black flex items-center justify-center",children:e.jsx("div",{className:"relative w-full h-full max-w-md mx-auto",children:t.thumbnail?t.type==="video"?e.jsx("div",{className:"w-full h-full bg-black flex items-center justify-center",children:e.jsx("video",{src:t.thumbnail.startsWith("/uploads/")?t.thumbnail:`/uploads/${t.thumbnail}`,className:"max-w-full max-h-full",controls:!0,autoPlay:!0,muted:!0,loop:!0,onLoadedMetadata:a=>{const r=a.target;r.videoWidth/r.videoHeight>1?(r.style.width="100%",r.style.height="auto"):(r.style.width="auto",r.style.height="100%")}},t.id)}):e.jsx("img",{src:t.thumbnail.startsWith("/uploads/")?t.thumbnail:`/uploads/${t.thumbnail}`,alt:`${t.creator.display_name}'s post`,className:"w-full h-full object-contain"}):t.id==="1"?e.jsx("img",{src:"https://placehold.co/1080x1920/E63946/FFFFFF?text=Creator+Post+1",alt:`${t.creator.display_name}'s post`,className:"w-full h-full object-contain"}):t.id==="2"?e.jsx("img",{src:"https://placehold.co/1080x1920/457B9D/FFFFFF?text=Creator+Post+2",alt:`${t.creator.display_name}'s post`,className:"w-full h-full object-contain"}):t.id==="3"?e.jsx("img",{src:"https://placehold.co/1080x1920/1D3557/FFFFFF?text=Creator+Post+3",alt:`${t.creator.display_name}'s post`,className:"w-full h-full object-contain"}):e.jsx("img",{src:`https://placehold.co/1080x1920/6366F1/FFFFFF?text=Creator+Post+${t.id}`,alt:`${t.creator.display_name}'s post`,className:"w-full h-full object-contain"})})}),e.jsxs("div",{className:"w-96 bg-background flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(N,{className:"h-10 w-10",children:[e.jsx(w,{src:t.creator.avatar?t.creator.avatar.startsWith("/uploads/")?t.creator.avatar:`/uploads/${t.creator.avatar}`:void 0,alt:t.creator.username}),e.jsx(y,{children:(t.creator.display_name||t.creator.username||"U").charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold text-foreground text-sm",children:["@",t.creator.username]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:p(t.posted)})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("p",{className:"text-sm leading-relaxed text-foreground line-clamp-2",children:t.content})})]}),e.jsx("div",{className:"px-4 py-3 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",className:`h-8 w-8 p-0 ${t.liked?"text-red-500":"text-muted-foreground"}`,onClick:()=>L(t.id),children:e.jsx(T,{className:`w-6 h-6 ${t.liked?"fill-current":""}`})}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:t.likes})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-muted-foreground",children:e.jsx(W,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:t.comments})]}),e.jsx(d,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-muted-foreground",onClick:()=>M(t.id),children:e.jsx(A,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(S,{postId:t.id,initialComments:t.initialComments||[],onCommentCountChange:a=>C(t.id,a),isBottomSheet:!1})})]})]})]})]})}),e.jsx(fe,{open:X,onOpenChange:E,children:e.jsxs(ge,{side:"bottom",className:"h-[75vh] p-0 border-t-4 border-border/30 rounded-t-xl bg-background flex flex-col",children:[e.jsxs(be,{className:"px-4 py-3 border-b border-border/20 bg-background shrink-0",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-1 bg-muted-foreground/30 rounded-full mb-2"})}),e.jsx(ve,{className:"text-center text-lg font-semibold text-foreground",children:"Comments"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-background",children:t&&e.jsx(S,{postId:t.id,initialComments:t.initialComments||[],onCommentCountChange:a=>C(t.id,a),isBottomSheet:!0})})]})})]})})]})};export{Le as FeedPage};
