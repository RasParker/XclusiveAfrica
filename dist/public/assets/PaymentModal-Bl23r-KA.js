import{i as v,u as E,a as V,b as I,r as n,j as e,D as L,p as F,q as H,s as q,E as R,C as U,d as $,e as A,f as B,g as G,t as J,h as y,B as u,F as O,I as W,S as Y}from"./index-DnjzDop3.js";import{S as K,a as Q,b as X,c as Z,d as h}from"./select-BgAE-lOE.js";import{S as ee}from"./smartphone-DXpypUrS.js";import{C as ae}from"./circle-alert-B8H_cjr7.js";import{L as se}from"./loader-circle--UTD5YcZ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=v("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=v("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),j=l=>l.trim()?/^(0|\+233)[2-9]\d{8}$/.test(l)?{isValid:!0}:{isValid:!1,error:"Please enter a valid Ghana phone number (e.g., 0244000000 or +233244000000)"}:{isValid:!1,error:"Phone number is required"},me=({isOpen:l,onClose:d,tier:t,creatorName:N})=>{const{user:r}=E(),{toast:x}=V(),P=I(),[i,g]=n.useState("card"),[o,w]=n.useState(""),[c,C]=n.useState("mtn"),[b,m]=n.useState(!1),[re,k]=n.useState(null),[p,f]=n.useState("");n.useEffect(()=>{l&&S()},[l]);const S=async()=>{try{const s=await(await fetch("/api/payments/config")).json();s.success&&k(s.data)}catch(a){console.error("Failed to fetch payment config:",a)}},M=async()=>{if(!(!r||!t)){console.log("Initializing card payment for:",{fan_id:r.id,tier_id:t.id,tier_name:t.name,payment_method:"card"}),m(!0);try{sessionStorage.setItem("lastCreatorProfile",window.location.pathname);const s=await(await fetch("/api/payments/initialize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fan_id:r.id,tier_id:t.id,payment_method:"card"})})).json();if(console.log("Payment initialization response:",s),s.success)console.log("Payment authorization URL:",s.data.authorization_url),s.data.authorization_url.startsWith("/")?(console.log("Development mode: navigating to callback"),d(),P(s.data.authorization_url)):(console.log("Production mode: redirecting to Paystack"),window.location.href=s.data.authorization_url);else throw new Error(s.message||"Payment initialization failed")}catch(a){console.error("Payment initialization error:",a),x({title:"Payment Error",description:a.message||"Failed to initialize payment. Please try again.",variant:"destructive"})}finally{m(!1)}}},_=async()=>{if(!r||!o||!c){console.error("Missing mobile money payment data:",{user:!!r,phoneNumber:!!o,mobileProvider:!!c});return}console.log("Initializing mobile money payment for:",{fan_id:r.id,tier_id:t.id,tier_name:t.name,phone:o,provider:c}),m(!0);try{sessionStorage.setItem("lastCreatorProfile",window.location.pathname);const s=await(await fetch("/api/payments/mobile-money/initialize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fan_id:r.id,tier_id:t.id,phone:o,provider:c})})).json();if(console.log("Mobile money payment initialization response:",s),s.success)x({title:"Mobile Money Payment",description:"Please check your phone and approve the payment request."}),d();else throw new Error(s.message||"Mobile money payment initialization failed")}catch(a){console.error("Mobile money payment error:",a),x({title:"Payment Error",description:a.message||"Failed to initialize mobile money payment. Please try again.",variant:"destructive"})}finally{m(!1)}},z=()=>{i==="card"?M():_()},T=a=>{if(w(a),a.trim()){const s=j(a);f(s.isValid?"":s.error||"")}else f("")},D=a=>j(a).isValid;return e.jsx(L,{open:l,onOpenChange:d,children:e.jsxs(F,{className:"sm:max-w-lg bg-[#08080c] backdrop-blur-xl border border-slate-700/50",children:[e.jsxs(H,{className:"text-center space-y-3",children:[e.jsxs(q,{className:"text-xl font-semibold text-white",children:["Subscribe to ",N]}),e.jsxs(R,{className:"text-slate-400",children:["Join the ",t.name," tier for exclusive content access"]})]}),e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsxs(U,{className:"border border-slate-700/50 backdrop-blur-sm",style:{backgroundColor:"#262626"},children:[e.jsx($,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{className:"text-lg text-slate-100",children:t.name}),e.jsx(B,{className:"text-slate-400 text-sm",children:t.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-gradient-primary",children:["GHS ",t.price]}),e.jsx("div",{className:"text-sm text-slate-400 px-2 py-1 rounded-full",style:{backgroundColor:"#262626"},children:"Monthly"})]})]})}),e.jsx(G,{className:"pt-0",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-300",children:[e.jsx(J,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{children:"Cancel anytime"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{className:"text-slate-200 font-medium",children:"Choose Payment Method"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(u,{variant:i==="card"?"default":"outline",onClick:()=>g("card"),className:`h-20 flex flex-col items-center gap-2 transition-all duration-200 ${i==="card"?"bg-gradient-primary text-white border-0 shadow-lg shadow-blue-500/25":"border-slate-600 bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 hover:border-slate-500"}`,children:[e.jsx(O,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Debit Card"})]}),e.jsxs(u,{variant:i==="mobile_money"?"default":"outline",onClick:()=>g("mobile_money"),className:`h-20 flex flex-col items-center gap-2 transition-all duration-200 ${i==="mobile_money"?"bg-gradient-primary text-white border-0 shadow-lg shadow-blue-500/25":"border-slate-600 bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 hover:border-slate-500"}`,children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Mobile Money"})]})]})]}),i==="mobile_money"&&e.jsxs("div",{className:"space-y-4 p-4 rounded-xl border border-slate-700/50",style:{backgroundColor:"#262626"},children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"phone",className:"text-slate-200 font-medium",children:"Phone Number"}),e.jsx(W,{id:"phone",type:"tel",placeholder:"0244000000",value:o,onChange:a=>T(a.target.value),className:`mt-2 bg-slate-700/50 border-slate-600 text-slate-100 placeholder:text-slate-400 focus:border-blue-500 focus:ring-blue-500/20 ${p?"border-red-500 focus:border-red-500":""}`}),p&&e.jsxs("p",{className:"text-sm text-red-400 mt-2 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 flex-shrink-0"}),p]})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"provider",className:"text-slate-200 font-medium",children:"Mobile Money Provider"}),e.jsxs(K,{value:c,onValueChange:a=>C(a),children:[e.jsx(Q,{className:"mt-2 bg-slate-700/50 border-slate-600 text-slate-100",children:e.jsx(X,{})}),e.jsxs(Z,{className:"bg-slate-800 border-slate-700",children:[e.jsx(h,{value:"mtn",children:"MTN Mobile Money"}),e.jsx(h,{value:"vod",children:"Vodafone Cash"}),e.jsx(h,{value:"tgo",children:"Tigo Cash"}),e.jsx(h,{value:"airtel",children:"AirtelTigo Money"})]})]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-xl border border-slate-700/50",style:{backgroundColor:"#262626"},children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-green-500/20 flex-shrink-0",children:e.jsx(Y,{className:"h-4 w-4 text-green-400"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium text-slate-200 text-sm",children:"Secure Payment"}),e.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"Your payment is processed securely through Paystack. We never store your payment details."})]})]}),e.jsx(u,{onClick:z,disabled:b||i==="mobile_money"&&(!o||!D(o)),className:"w-full py-6 text-lg font-semibold bg-gradient-primary hover:opacity-90 text-white border-0 shadow-lg shadow-blue-500/25 transition-all duration-200 hover:shadow-blue-500/30 hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",size:"lg",children:b?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Processing Payment..."})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),e.jsxs("span",{children:["Pay GHS ",t.price,"/month"]})]})}),e.jsx("p",{className:"text-center text-xs text-slate-500",children:"By subscribing, you agree to our terms and conditions"})]})]})})};export{me as P,de as U};
