import{a as L,b as O,u as z,r as h,j as e,B as d,C as j,d as b,e as N,f as S,g as v,h as f,I as y,l as G}from"./index-DnjzDop3.js";import{T as I}from"./textarea-ChWCN1Go.js";import{D as J}from"./dollar-sign-CzBPYBMC.js";import{P as E}from"./plus-9blh9VHl.js";import{T as F}from"./trash-2-DTtK-_sv.js";import{S as $}from"./square-pen-CNc_pLH1.js";const V=()=>{const{toast:o}=L();O();const{user:a}=z(),[m,p]=h.useState([]),[T,u]=h.useState(!1),[l,g]=h.useState(null),[r,c]=h.useState({name:"",price:"",description:"",benefits:[""]}),[w,C]=h.useState(!1);h.useEffect(()=>{(async()=>{if(a!=null&&a.id)try{const i=await fetch(`/api/creators/${a.id}/tiers`);if(i.ok){const t=await i.json();p(t)}else console.error("Failed to fetch tiers"),p([])}catch(i){console.error("Error fetching tiers:",i),p([])}})()},[a==null?void 0:a.id]);const k=()=>{u(!0),c({name:"",price:"",description:"",benefits:[""]})},P=s=>{g(s),c({name:s.name,price:s.price.toString(),description:s.description,benefits:s.benefits})},D=async()=>{if(!r.name||!r.price||!r.description||!(a!=null&&a.id)){o({title:"Missing information",description:"Please fill in all required fields.",variant:"destructive"});return}C(!0);try{const s={name:r.name,price:parseFloat(r.price),description:r.description,benefits:r.benefits.filter(t=>t.trim()!=="")};let i;if(l?i=await fetch(`/api/tiers/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}):i=await fetch(`/api/creators/${a.id}/tiers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),i.ok){const t=await i.json();l?(p(n=>n.map(x=>x.id===l.id?t:x)),o({title:"Tier updated",description:"Subscription tier has been updated successfully."})):(p(n=>[...n,t]),o({title:"Tier created",description:"New subscription tier has been created successfully."}))}else throw new Error("Failed to save tier")}catch(s){console.error("Error saving tier:",s),o({title:"Error",description:"Failed to save subscription tier. Please try again.",variant:"destructive"})}u(!1),g(null),c({name:"",price:"",description:"",benefits:[""]}),C(!1)},B=async s=>{try{if((await fetch(`/api/tiers/${s}`,{method:"DELETE"})).ok)p(t=>t.filter(n=>n.id!==s)),o({title:"Tier deleted",description:"Subscription tier has been deleted successfully."});else throw new Error("Failed to delete tier")}catch(i){console.error("Error deleting tier:",i),o({title:"Error",description:"Failed to delete subscription tier. Please try again.",variant:"destructive"})}},H=(s,i)=>{c(t=>({...t,benefits:t.benefits.map((n,x)=>x===s?i:n)}))},M=()=>{c(s=>({...s,benefits:[...s.benefits,""]}))},A=s=>{c(i=>({...i,benefits:i.benefits.filter((t,n)=>n!==s)}))};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2 flex items-center gap-2 justify-center sm:justify-start",children:[e.jsx(J,{className:"w-6 h-6 sm:w-8 sm:h-8 text-primary"}),"Manage Subscription Tiers"]}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Set up and customize your subscription offerings"})]}),!T&&!l&&e.jsxs(d,{onClick:k,className:"bg-primary hover:bg-primary/90",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Create Tier"]})]})}),e.jsxs("div",{className:"grid gap-6",children:[(T||l)&&e.jsxs(j,{className:"bg-gradient-card border-border/50",children:[e.jsxs(b,{children:[e.jsx(N,{children:l?"Edit Tier":"Create New Tier"}),e.jsx(S,{children:"Set up your subscription tier details and benefits"})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"name",children:"Tier Name"}),e.jsx(y,{id:"name",placeholder:"e.g., Premium Supporter",value:r.name,onChange:s=>c(i=>({...i,name:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"price",children:"Monthly Price (GHS)"}),e.jsx(y,{id:"price",type:"number",min:"0",step:"0.01",placeholder:"9.99",value:r.price,onChange:s=>c(i=>({...i,price:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"description",children:"Description"}),e.jsx(I,{id:"description",placeholder:"Describe what this tier includes...",value:r.description,onChange:s=>c(i=>({...i,description:s.target.value})),rows:3})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{children:"Benefits & Features"}),r.benefits.map((s,i)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{placeholder:"Enter a benefit...",value:s,onChange:t=>H(i,t.target.value)}),r.benefits.length>1&&e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>A(i),children:e.jsx(F,{className:"w-4 h-4"})})]},i)),e.jsxs(d,{type:"button",variant:"outline",onClick:M,children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Add Benefit"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(d,{onClick:D,disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-background border-t-foreground"}),l?"Updating...":"Creating..."]}):l?"Update Tier":"Create Tier"}),e.jsx(d,{variant:"outline",onClick:()=>{u(!1),g(null),c({name:"",price:"",description:"",benefits:[""]})},children:"Cancel"})]})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(s=>e.jsxs(j,{className:"bg-gradient-card border-border/50",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{className:"text-lg",children:s.name}),e.jsxs(G,{variant:"outline",children:["GHS ",s.price,"/mo"]})]}),e.jsx(S,{children:s.description})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsx("ul",{className:"space-y-2",children:(()=>{let i=s.benefits||[];if(typeof i=="string")try{i=JSON.parse(i)}catch(t){console.warn("Failed to parse benefits JSON:",t),i=[]}return(!i||!Array.isArray(i))&&(i=[]),i.length===0?e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full"}),e.jsx("span",{children:"No benefits specified"})]}):i.map((t,n)=>e.jsxs("li",{className:"text-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full"}),t]},n))})()}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>P(s),children:e.jsx($,{className:"w-4 h-4"})}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>B(s.id),children:e.jsx(F,{className:"w-4 h-4"})})]})]})]},s.id))}),e.jsxs(j,{className:"bg-gradient-card border-border/50",children:[e.jsx(b,{children:e.jsx(N,{children:"Tier Statistics"})}),e.jsx(v,{className:"space-y-4",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:m.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Active Tiers"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["GHS ",m.length>0?Math.min(...m.map(s=>s.price)):0]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Lowest Price"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["GHS ",m.length>0?Math.max(...m.map(s=>s.price)):0]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Highest Price"})]})]})})]})]})]})})};export{V as ManageTiers};
