import{b as j,aS as w,a as S,u as N,r as i,j as e,C as b,d as v,e as k,f as T,g as I,B as x}from"./index-DnjzDop3.js";import{L as B}from"./loader-circle--UTD5YcZ.js";import{C as h}from"./circle-x-DXUbMNCI.js";import{C as E}from"./circle-check-big-CTWGQ5qD.js";const Y=()=>{const t=j(),[n]=w(),{toast:u}=S();N();const[s,a]=i.useState("loading"),[y,r]=i.useState("");i.useEffect(()=>{const c=async()=>{const o=n.get("reference"),C=n.get("status");if(console.log("Payment callback params:",{reference:o,paymentStatus:C}),!o){a("failed"),r("Payment reference not found");return}try{console.log("Verifying payment with backend...");const l=await(await fetch(`/api/payments/verify/${o}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();console.log("Payment verification result:",l),l.success&&l.data.status==="success"?(a("success"),r("Payment successful! Your subscription is now active."),u({title:"Payment Successful",description:"Your subscription has been activated successfully!"}),setTimeout(()=>{const f=sessionStorage.getItem("lastCreatorProfile");f?(sessionStorage.removeItem("lastCreatorProfile"),t(f)):t("/fan/dashboard")},3e3)):(a("failed"),r(l.message||"Payment verification failed"))}catch(d){console.error("Payment verification error:",d),a("failed"),r("Failed to verify payment. Please contact support.")}},m=n.get("status");m==="success"?c():m==="cancelled"?(a("cancelled"),r("Payment was cancelled")):c()},[n,t,u]);const p=()=>{switch(s){case"success":return e.jsx(E,{className:"w-16 h-16 text-green-500"});case"failed":return e.jsx(h,{className:"w-16 h-16 text-red-500"});case"cancelled":return e.jsx(h,{className:"w-16 h-16 text-yellow-500"});default:return e.jsx(B,{className:"w-16 h-16 text-primary animate-spin"})}},g=()=>{switch(s){case"success":return"Payment Successful!";case"failed":return"Payment Failed";case"cancelled":return"Payment Cancelled";default:return"Processing Payment..."}},P=()=>{switch(s){case"success":return"text-green-600";case"failed":return"text-red-600";case"cancelled":return"text-yellow-600";default:return"text-primary"}};return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(b,{className:"w-full max-w-md",children:[e.jsxs(v,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:p()}),e.jsx(k,{className:`text-2xl ${P()}`,children:g()}),e.jsx(T,{children:y||"Please wait while we process your payment..."})]}),e.jsxs(I,{className:"text-center space-y-4",children:[s==="loading"&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"This may take a few moments..."}),s==="success"&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Redirecting you back to the creator profile..."}),(s==="failed"||s==="cancelled")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(x,{onClick:()=>{const c=sessionStorage.getItem("lastCreatorProfile");c?(sessionStorage.removeItem("lastCreatorProfile"),t(c)):t("/fan/dashboard")},className:"w-full",children:"Return to Profile"}),e.jsx(x,{variant:"outline",onClick:()=>t("/fan/dashboard"),className:"w-full",children:"Go to Dashboard"})]})]})]})})};export{Y as default};
