import{r as y,a as g,u as b,w,a8 as C,x as c,j as e,l as k,C as A,g as T,au as _,a0 as F,A as q,m as E,n as Q,B as d,av as S,L as K}from"./index-DnjzDop3.js";import{T as L,a as B,b as f}from"./tabs-Tn3DyEKi.js";import{C as P,a as z,b as D}from"./collapsible-B5WvucI8.js";import{T as I}from"./trash-2-DTtK-_sv.js";const $=()=>{const[r,j]=y.useState("all"),{toast:o}=g();b();const t=w(),{data:i=[],isLoading:p}=C({queryKey:["notifications","list"],queryFn:async()=>{const s=await fetch("/api/notifications");if(!s.ok)throw new Error("Failed to fetch notifications");return s.json()},refetchInterval:3e4}),n=c({mutationFn:async s=>{const a=await fetch(`/api/notifications/${s}/read`,{method:"PATCH"});if(!a.ok)throw new Error("Failed to mark as read");return a.json()},onSuccess:()=>{t.invalidateQueries({queryKey:["notifications","list"]}),t.invalidateQueries({queryKey:["notifications","unread-count"]})}});c({mutationFn:async()=>{const s=await fetch("/api/notifications/mark-all-read",{method:"PATCH"});if(!s.ok)throw new Error("Failed to mark all as read");return s.json()},onSuccess:()=>{t.invalidateQueries({queryKey:["notifications","list"]}),t.invalidateQueries({queryKey:["notifications","unread-count"]}),o({title:"Success",description:"All notifications marked as read"})}});const u=c({mutationFn:async s=>{const a=await fetch(`/api/notifications/${s}`,{method:"DELETE"});if(!a.ok)throw new Error("Failed to delete notification");return a.json()},onSuccess:()=>{t.invalidateQueries({queryKey:["notifications","list"]}),t.invalidateQueries({queryKey:["notifications","unread-count"]}),o({title:"Success",description:"Notification deleted"})}}),v=s=>{s.read||n.mutate(s.id)},N=s=>{switch(s){case"new_subscriber":return"👥";case"new_message":return"💬";case"new_comment":return"💭";case"new_post":return"📝";case"payment_success":return"💰";case"payment_failed":return"❌";case"payout_completed":return"💳";case"like":return"❤️";default:return"📢"}},m=r==="unread"?i.filter(s=>!s.read):i,l=i.filter(s=>!s.read).length;return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6 sm:mb-8 text-center sm:text-left",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2 flex items-center gap-2 justify-center sm:justify-start",children:"Notifications"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Stay updated with your latest activity"})]}),e.jsx(L,{value:r,onValueChange:s=>j(s),className:"mb-6",children:e.jsxs(B,{children:[e.jsx(f,{value:"all",children:"All Notifications"}),e.jsxs(f,{value:"unread",className:"relative",children:["Unread",l>0&&e.jsx(k,{variant:"destructive",className:"ml-2 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:l>99?"99+":l})]})]})}),e.jsx(A,{children:e.jsx(T,{className:"p-0",children:p?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading notifications..."}):m.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(_,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:r==="unread"?"No unread notifications":"No notifications yet"}),e.jsx("p",{className:"text-muted-foreground",children:r==="unread"?"All caught up! Check back later for new updates.":"When you receive notifications, they'll appear here."})]}):e.jsx("div",{className:"divide-y",children:m.map(s=>{var a,x,h;return e.jsx(P,{asChild:!0,className:F("p-4 hover:bg-accent/50 transition-colors",!s.read&&"bg-accent/20 border-l-4 border-l-primary"),children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:(a=s.actor)!=null&&a.avatar?e.jsxs(q,{className:"h-10 w-10",children:[e.jsx(E,{src:s.actor.avatar,alt:s.actor.display_name}),e.jsx(Q,{children:((x=s.actor.display_name)==null?void 0:x.charAt(0))||((h=s.actor.username)==null?void 0:h.charAt(0))})]}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:N(s.type)})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(z,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-2 mb-1 cursor-pointer",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:s.title}),!s.read&&e.jsx("div",{className:"h-2 w-2 bg-primary rounded-full"})]})}),e.jsx("p",{className:"text-muted-foreground mb-2",children:s.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.time_ago})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[!s.read&&e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>n.mutate(s.id),disabled:n.isPending,children:e.jsx(S,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>u.mutate(s.id),disabled:u.isPending,className:"text-destructive hover:text-destructive",children:e.jsx(I,{className:"w-4 h-4"})})]})]}),s.action_url&&e.jsx("div",{className:"mt-3",children:e.jsx(K,{to:s.action_url,children:e.jsx(d,{variant:"outline",size:"sm",onClick:()=>v(s),children:"View Details"})})})]})]}),e.jsx(D,{children:s.metadata&&e.jsxs("div",{className:"mt-4 p-3 bg-secondary/50 rounded-md",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Details"}),e.jsx("pre",{className:"text-xs overflow-x-auto whitespace-pre-wrap",children:JSON.stringify(s.metadata,null,2)})]})})]})},s.id)})})})})]})})};export{$ as Notifications};
