import{u as H,r as c,j as e,C as l,g as d,F as W,d as j,e as f,f as R,B as n,L as i,A as b,m as y,n as w,l as U,M as z}from"./index-DnjzDop3.js";import{E as p}from"./EdgeToEdgeContainer-kS07pzFb.js";import{L as C}from"./LoadingSpinner-D0nQGNMo.js";import{H as S}from"./heart-BIzJO6uv.js";import{T as A}from"./trending-up-BqdnV6XC.js";import{C as I}from"./calendar-We5RV4OF.js";const q=()=>{const{user:t}=H(),[o,E]=c.useState([]),[x,m]=c.useState([]),[k,h]=c.useState(0),[L,T]=c.useState(!0),[F,D]=c.useState(!0),[g,M]=c.useState(null),N=async()=>{if(t)try{const s=await fetch(`/api/subscriptions/fan/${t.id}`,{credentials:"include",headers:{"Content-Type":"application/json"}}),r=s.headers.get("content-type");if(!r||!r.includes("application/json"))throw new Error("Server returned an invalid response");if(!s.ok){const P=await s.json().catch(()=>({}));throw new Error(P.message||"Failed to fetch subscriptions")}const a=await s.json();E(Array.isArray(a)?a:[])}catch(s){console.error("Error fetching subscriptions:",s),M(s instanceof Error?s.message:"Failed to load subscriptions")}finally{T(!1)}},v=async()=>{if(t)try{const s=await fetch(`/api/fan/${t.id}/recent-activity`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(s.ok){const r=s.headers.get("content-type");if(r&&r.includes("application/json")){const a=await s.json();m(Array.isArray(a)?a:a.activities||[])}else m([])}else m([])}catch(s){console.error("Error fetching recent activity:",s),m([])}finally{D(!1)}},u=async()=>{if(t)try{const s=await fetch(`/api/fan/${t.id}/new-content-count`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(s.ok){const r=s.headers.get("content-type");if(r&&r.includes("application/json")){const a=await s.json();h(a.count||0)}else h(0)}else h(0)}catch(s){console.error("Error fetching new content count:",s),h(0)}};return c.useEffect(()=>{N(),v(),u()},[t]),c.useEffect(()=>{if(t!=null&&t.id){const s=setInterval(()=>{u()},3e4);return()=>clearInterval(s)}},[t]),c.useEffect(()=>{const s=()=>{console.log("ðŸ”„ Dashboard: Subscription update detected, refreshing..."),t!=null&&t.id&&(N(),v(),u())},r=a=>{a.key==="subscriptionUpdate"&&s()};return window.addEventListener("subscriptionStatusChange",s),window.addEventListener("storage",r),()=>{window.removeEventListener("subscriptionStatusChange",s),window.removeEventListener("storage",r)}},[t]),e.jsxs(p,{children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 via-accent/5 to-primary/10 border-b border-border",children:e.jsx(p,{maxWidth:"7xl",enablePadding:!0,enableTopPadding:!0,children:e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-bold text-foreground mb-4",children:["Welcome back, ",t==null?void 0:t.username,"!"]}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Here's what's happening with your favorite creators"})]})})}),e.jsx(p,{maxWidth:"7xl",enablePadding:!0,className:"py-6 sm:py-8",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 lg:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx(l,{className:"bg-gradient-card border-border/50",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Subscriptions"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:o.filter(s=>s.status==="active").length})]}),e.jsx(S,{className:"h-8 w-8 text-white",strokeWidth:1})]})})}),e.jsx(l,{className:"bg-gradient-card border-border/50",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Monthly Spending"}),e.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["GHS ",o.filter(s=>s.status==="active").reduce((s,r)=>s+parseFloat(r.tier.price),0).toFixed(2)]})]}),e.jsx(W,{className:"h-8 w-8 text-white",strokeWidth:1})]})})}),e.jsx(l,{className:"bg-gradient-card border-border/50",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"New Content"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:k})]}),e.jsx(A,{className:"h-8 w-8 text-white",strokeWidth:1})]})})})]}),e.jsxs(l,{className:"bg-gradient-card border-border/50",children:[e.jsxs(j,{children:[e.jsx(f,{className:"text-xl",children:"Your Subscriptions"}),e.jsx(R,{children:"Manage your active creator subscriptions"})]}),e.jsx(d,{children:L?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(C,{})}):g?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsxs("p",{children:["Error loading subscriptions: ",g]})}):o.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No active subscriptions yet."}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center mt-4",children:e.jsx(n,{variant:"premium",asChild:!0,children:e.jsx(i,{to:"/explore",children:"Discover Creators"})})})]}):e.jsxs("div",{className:"space-y-4",children:[o.map(s=>{var r;return e.jsx("div",{className:"p-4 rounded-lg bg-muted/10 border border-border/50",children:e.jsxs("div",{className:"flex items-start gap-3 sm:items-center",children:[e.jsxs(b,{className:"w-12 h-12 flex-shrink-0",children:[e.jsx(y,{src:s.creator.avatar,alt:s.creator.username,className:"object-cover"}),e.jsx(w,{className:"text-sm",children:((r=s.creator.display_name)==null?void 0:r.charAt(0))||s.creator.username.charAt(0)})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:s.creator.display_name||s.creator.username}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.tier.name}),e.jsxs("p",{className:"text-xs font-medium text-foreground mt-1",children:["GHS ",s.tier.price,"/month"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx(U,{variant:s.status==="active"?"success":s.status==="paused"?"secondary":"destructive",className:"text-xs",children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),e.jsx(n,{variant:"outline",size:"sm",className:"w-full sm:w-auto",asChild:!0,children:e.jsx(i,{to:`/creator/${s.creator.username}`,children:"View Profile"})})]})]})})]})},s.id)}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center mt-6",children:e.jsx(n,{variant:"premium",asChild:!0,children:e.jsx(i,{to:"/fan/subscriptions",children:"Manage All Subscriptions"})})})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(l,{className:"bg-gradient-card border-border/50",children:e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs(i,{to:"/fan/feed",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"View My Feed"]})}),e.jsx(n,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs(i,{to:"/explore",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Discover Creators"]})}),e.jsx(n,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs(i,{to:"/fan/messages",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Messages"]})}),e.jsx(n,{variant:"outline",className:"w-full justify-start",asChild:!0,children:e.jsxs(i,{to:"/fan/favorites",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"My Favorites"]})})]})]})}),e.jsx(l,{className:"bg-gradient-card border-border/50",children:e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Payment Info"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Next billing"}),e.jsx("span",{className:"font-medium",children:o.length>0?new Date(o[0].current_period_end).toLocaleDateString():"No active subscriptions"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment method"}),e.jsx("span",{className:"font-medium",children:"â€¢â€¢â€¢â€¢ 4242"})]}),e.jsx(n,{variant:"outline",size:"sm",className:"w-full",asChild:!0,children:e.jsx(i,{to:"/fan/payment",children:"Update Payment Method"})})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{className:"bg-gradient-card border-border/50 overflow-hidden",children:[e.jsx(j,{className:"pb-0",children:e.jsx(f,{className:"text-lg",children:"Recent Activity"})}),e.jsx(d,{className:"p-0",children:F?e.jsx("div",{className:"px-6 py-8 text-center",children:e.jsx(C,{})}):x.length===0?e.jsxs("div",{className:"px-6 py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-sm",children:"No recent activity"}),e.jsx("p",{className:"text-xs",children:"Subscribe to creators to see their latest posts"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-h-80 overflow-y-auto space-y-0 scrollbar-thin scrollbar-thumb-muted scrollbar-track-transparent",children:[(Array.isArray(x)?x:[]).slice(0,5).map((s,r)=>e.jsx("div",{className:"px-6 py-3 hover:bg-background/50 transition-colors border-b border-border/20 last:border-b-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(b,{className:"h-8 w-8",children:[e.jsx(y,{src:s.avatar,alt:s.creator}),e.jsx(w,{children:s.creator.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm leading-relaxed",children:[e.jsx("span",{className:"font-medium",children:s.creator})," ",e.jsx("span",{className:"text-muted-foreground",children:s.message})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.time})]})]})},s.id)),x.length>10&&e.jsx("div",{className:"px-6 py-3 text-center border-t border-border/20 bg-muted/10",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing 10 of ",x.length," activities"]})})]}),e.jsx("div",{className:"px-6 py-3 bg-muted/20",children:e.jsx(n,{variant:"ghost",size:"sm",className:"w-full text-muted-foreground",asChild:!0,children:e.jsx(i,{to:"/fan/feed",children:"View all activity"})})})]})})]}),e.jsxs(l,{className:"bg-gradient-card border-border/50",children:[e.jsx(j,{children:e.jsx(f,{className:"text-lg",children:"Recommended for You"})}),e.jsxs(d,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Discover new creators based on your interests"}),e.jsx(n,{variant:"premium",size:"sm",className:"w-full",asChild:!0,children:e.jsx(i,{to:"/explore",children:"Explore Now"})})]})]})]})]})})]})};export{q as FanDashboard};
