import{i as q,v as G,b as X,a as Q,u as Y,r as m,j as e,B as l,X as ee,A as N,m as v,n as w,M as D,z as se,G as te,J as ae,K as re,N as ne}from"./index-DnjzDop3.js";import{C as P}from"./CommentSection-DatytXQU.js";import{A}from"./arrow-left-DJTbtmZM.js";import{H as U}from"./heart-BIzJO6uv.js";import{S as B}from"./share-2-BCHyK8hT.js";import{P as R}from"./play-B34JkaPD.js";import"./textarea-ChWCN1Go.js";import"./select-BgAE-lOE.js";import"./chevron-up-CD9nw7va.js";import"./flag-D_PcH8BI.js";import"./send-Baqb8pKh.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=q("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),ge=()=>{var W;const{id:f}=G(),o=X(),{toast:x}=Q(),{user:a}=Y(),[t,b]=m.useState(null),[H,J]=m.useState(!0),[u,S]=m.useState(!1),[$,M]=m.useState(null),[p,z]=m.useState(!1),[K,T]=m.useState(!1),[E,O]=m.useState([]),y=s=>{if(s==="CURRENT_TIMESTAMP")return"Just now";const r=new Date(s);if(isNaN(r.getTime()))return"Just now";const d=new Date().getTime()-r.getTime(),h=Math.floor(d/(1e3*60)),n=Math.floor(d/(1e3*60*60)),c=Math.floor(d/(1e3*60*60*24));return h<1?"Just now":h<60?`${h}m ago`:n<24?`${n}h ago`:c<7?`${c}d ago`:`${Math.floor(c/7)}w ago`};m.useEffect(()=>{const s=async()=>{var i,d,h;if(f)try{const n=await fetch(`/api/posts/${f}`);if(n.ok){const c=await n.json(),k={...c,creator_display_name:((i=c.creator)==null?void 0:i.username)||"Unknown Creator",creator_username:((d=c.creator)==null?void 0:d.username)||"unknown",creator_avatar:((h=c.creator)==null?void 0:h.avatar)||null};if(b(k),a){const g=await fetch(`/api/posts/${f}/like/${a.id}`);if(g.ok){const C=await g.json();z(C.liked)}}}else x({title:"Error",description:"Failed to load video.",variant:"destructive"}),o("/fan/feed")}catch(n){console.error("Error fetching post:",n),x({title:"Error",description:"Failed to load video.",variant:"destructive"}),o("/fan/feed")}finally{J(!1)}},r=async()=>{try{const i=await fetch("/api/posts");if(i.ok){const h=(await i.json()).filter(n=>n.id.toString()!==f).slice(0,5).map(n=>{var c,k,g,C;return{...n,creator_display_name:((c=n.creator)==null?void 0:c.display_name)||((k=n.creator)==null?void 0:k.username)||n.display_name||n.username||"Unknown Creator",creator_username:((g=n.creator)==null?void 0:g.username)||n.username||"unknown",creator_avatar:((C=n.creator)==null?void 0:C.avatar)||n.avatar||null}});O(h)}}catch(i){console.error("Error fetching next videos:",i)}};s(),r()},[f,a,x,o]);const L=async()=>{if(!(!a||!t))try{p?await fetch(`/api/posts/${t.id}/like`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.id})}):await fetch(`/api/posts/${t.id}/like`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.id})}),z(!p),b(s=>({...s,likes_count:p?s.likes_count-1:s.likes_count+1}))}catch(s){console.error("Error liking post:",s)}},I=()=>{navigator.clipboard.writeText(window.location.href),x({title:"Link copied",description:"Video link has been copied to your clipboard."})},Z=()=>{$==="portrait"&&S(!u)},F=s=>{const r=s.target;r.videoWidth/r.videoHeight>1?(M("landscape"),r.setAttribute("data-aspect-ratio","landscape")):(M("portrait"),r.setAttribute("data-aspect-ratio","portrait"))},V=s=>{o(`/video/${s}`)};if(m.useEffect(()=>{const s=r=>{r.key==="Escape"&&u&&S(!1)};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[u]),H)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});if(!t)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Video not found"}),e.jsxs(l,{onClick:()=>o("/fan/feed"),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Back to Feed"]})]})});const j=Array.isArray(t.media_urls)?t.media_urls[0]:t.media_urls,_=j!=null&&j.startsWith("http")?j:`/uploads/${j}`;return e.jsxs("div",{className:`min-h-screen bg-background ${u?"is-immersive":""}`,children:[e.jsxs("div",{className:"md:hidden",children:[e.jsxs("div",{className:"video-player-wrapper relative bg-black w-full",children:[!u&&e.jsx(l,{variant:"ghost",size:"sm",className:"absolute top-4 left-4 z-10 text-white hover:bg-white/20",onClick:()=>{t&&t.creator_username?o(`/creator/${t.creator_username}`):(a==null?void 0:a.role)==="creator"?o(`/creator/${a.username}`):o("/fan/feed")},children:e.jsx(A,{className:"w-5 h-5"})}),u&&e.jsx(l,{variant:"ghost",size:"sm",className:"absolute top-4 right-4 z-10 text-white hover:bg-white/20",onClick:()=>S(!1),children:e.jsx(ee,{className:"w-5 h-5"})}),$==="portrait"&&!u&&e.jsx(l,{variant:"ghost",size:"sm",className:"absolute top-4 right-4 z-10 text-white hover:bg-white/20",onClick:Z,children:e.jsx(ie,{className:"w-5 h-5"})}),t.media_type==="video"?e.jsx("video",{src:_,className:"w-full h-full video-element",controls:!0,playsInline:!0,onLoadedMetadata:F,style:{objectFit:"contain",backgroundColor:"black"}}):e.jsx("img",{src:_,alt:t.title,className:"w-full h-full object-contain bg-black"})]}),e.jsx("div",{className:"content-wrapper bg-background scrollbar-hide",children:e.jsxs("div",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsxs(N,{className:"h-9 w-9 flex-shrink-0",children:[e.jsx(v,{src:t.creator_avatar?t.creator_avatar.startsWith("/uploads/")?t.creator_avatar:`/uploads/${t.creator_avatar}`:void 0,alt:t.creator_username}),e.jsx(w,{className:"text-sm",children:(t.creator_display_name||t.creator_username||"U").charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("h1",{className:"text-sm font-medium text-foreground line-clamp-2",children:t.content||"Untitled Post"}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:t.creator_display_name||t.creator_username}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[t.views_count?t.views_count>=1e3?`${Math.floor(t.views_count/1e3)}K`:t.views_count:"0"," views"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:y(t.posted||t.created_at)})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6 px-2 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsxs(l,{variant:"ghost",size:"sm",className:`flex items-center gap-1 h-auto py-2 px-2 ${p?"text-red-500":"text-muted-foreground"}`,onClick:L,children:[e.jsx(U,{className:`w-4 h-4 ${p?"fill-current":""}`}),e.jsx("span",{className:"text-sm",children:t.likes_count||0})]}),e.jsxs(l,{variant:"ghost",size:"sm",className:"flex items-center gap-1 h-auto py-2 px-2 text-muted-foreground",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:t.comments_count||0})]}),e.jsxs(l,{variant:"ghost",size:"sm",className:"flex items-center gap-1 h-auto py-2 px-2 text-muted-foreground",onClick:I,children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Share"})]})]}),a&&t.creator_id===a.id&&e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsxs(l,{variant:"ghost",size:"sm",className:"flex items-center gap-1 h-auto py-2 px-2 text-muted-foreground hover:text-foreground",onClick:()=>o(`/creator/edit-post/${t.id}`),children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3Z"})}),e.jsx("span",{className:"text-xs",children:"Edit"})]}),e.jsxs(l,{variant:"ghost",size:"sm",className:"flex items-center gap-1 h-auto py-2 px-2 text-red-500 hover:text-red-600",onClick:async()=>{if(window.confirm("Are you sure you want to delete this post?"))try{if((await fetch(`/api/posts/${t.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)x({title:"Success",description:"Post deleted successfully"}),o("/creator/dashboard");else throw new Error("Failed to delete post")}catch{x({title:"Error",description:"Failed to delete post",variant:"destructive"})}},children:[e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 0 0 1-2-2V6h14Z"}),e.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),e.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]}),e.jsx("span",{className:"text-xs",children:"Delete"})]})]})]}),e.jsxs("div",{className:"bg-background border border-border rounded-lg p-4 mb-6 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>T(!0),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-base font-semibold",children:"Comments"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t.comments_count||379})]}),e.jsx(se,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[e.jsxs(N,{className:"h-6 w-6",children:[e.jsx(v,{src:a==null?void 0:a.avatar,alt:a==null?void 0:a.username}),e.jsx(w,{className:"text-xs",children:(W=a==null?void 0:a.username)==null?void 0:W.charAt(0).toUpperCase()})]}),e.jsx("div",{className:"flex-1 bg-muted/50 rounded-full px-4 py-2",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:"Add a comment..."})})]})]}),e.jsxs("div",{className:"space-y-0 -mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 px-4 text-foreground",children:"Up next"}),e.jsx("div",{className:"space-y-0",children:E.map(s=>{const r=Array.isArray(s.media_urls)?s.media_urls[0]:s.media_urls,i=r!=null&&r.startsWith("http")?r:`/uploads/${r}`;return e.jsx("div",{className:"cursor-pointer hover:bg-muted/50 transition-colors border-b border-border/20 last:border-b-0",onClick:()=>V(s.id),children:e.jsxs("div",{className:"py-3",children:[e.jsxs("div",{className:"relative w-full aspect-video bg-black overflow-hidden mb-3 rounded-lg",children:[s.media_type==="video"?e.jsx("video",{src:i,className:"w-full h-full object-cover",muted:!0}):e.jsx("img",{src:i,alt:s.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(R,{className:"w-6 h-6 text-white",fill:"white"})}),s.duration&&e.jsxs("div",{className:"absolute bottom-1 right-1 bg-black text-white text-xs px-1 rounded",children:[Math.floor(s.duration/60),":",(s.duration%60).toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"flex gap-3 px-4",children:[e.jsxs(N,{className:"h-9 w-9 flex-shrink-0",children:[e.jsx(v,{src:s.creator_avatar||s.avatar,alt:s.creator_username||s.username}),e.jsx(w,{className:"text-sm",children:(s.creator_display_name||s.creator_username||s.display_name||s.username||"U").charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-xs font-light text-foreground line-clamp-2 mb-1 leading-tight",children:s.title||s.content}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground w-full",children:[e.jsx("span",{className:"truncate mr-2",children:s.creator_display_name||s.creator_username}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 text-right",children:[e.jsxs("span",{children:[Math.floor(Math.random()*500)+100,"K views"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:y(s.created_at)})]})]})]})]})]})},s.id)})})]})]})}),e.jsx(te,{open:K,onOpenChange:T,children:e.jsxs(ae,{side:"bottom",className:"h-[85vh] p-0 border-t-4 border-border/30 rounded-t-xl bg-background flex flex-col",children:[e.jsxs(re,{className:"px-4 py-3 border-b border-border/20 bg-background shrink-0",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-1 bg-muted-foreground/30 rounded-full mb-2"})}),e.jsx(ne,{className:"text-lg font-semibold text-foreground text-center",children:"Comments"}),e.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[e.jsx(l,{variant:"default",size:"sm",className:"rounded-full",children:"Top"}),e.jsx(l,{variant:"ghost",size:"sm",className:"rounded-full",children:"Newest"})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(P,{postId:t.id.toString(),initialComments:[],onCommentCountChange:s=>b(r=>({...r,comments_count:s})),isBottomSheet:!0})})]})})]}),e.jsx("div",{className:"hidden md:flex min-h-screen bg-background justify-center",children:e.jsx("div",{className:"w-full max-w-8xl px-6",children:e.jsxs("div",{className:"flex gap-6 py-6 justify-center",children:[e.jsxs("div",{className:"flex-1 max-w-6xl",children:[e.jsxs(l,{variant:"ghost",size:"sm",className:"mb-4 text-muted-foreground hover:text-foreground",onClick:()=>{t&&t.creator_username?o(`/creator/${t.creator_username}`):(a==null?void 0:a.role)==="creator"?o(`/creator/${a.username}`):o("/fan/feed")},children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Back to Feed"]}),e.jsx("div",{className:"bg-black rounded-lg overflow-hidden mb-4",children:t.media_type==="video"?e.jsx("video",{src:_,className:"w-full aspect-video",controls:!0,onLoadedMetadata:F,style:{objectFit:"contain",backgroundColor:"black"}}):e.jsx("img",{src:_,alt:t.title,className:"w-full aspect-video object-contain bg-black"})}),e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsxs(N,{className:"h-9 w-9 flex-shrink-0",children:[e.jsx(v,{src:t.creator_avatar?t.creator_avatar.startsWith("/uploads/")?t.creator_avatar:`/uploads/${t.creator_avatar}`:void 0,alt:t.creator_username}),e.jsx(w,{className:"text-sm",children:(t.creator_display_name||t.creator_username||"U").charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-sm font-medium text-foreground line-clamp-2 mb-1",children:t.content}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground w-full",children:[e.jsx("span",{className:"truncate mr-2",children:t.creator_display_name||t.creator_username}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 text-right",children:[e.jsx("span",{children:"876K views"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:y(t.created_at)})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-border overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-6 flex-1 min-w-0",children:[e.jsxs(l,{variant:"ghost",size:"sm",className:`flex items-center gap-2 h-auto py-2 px-3 ${p?"text-red-500":"text-muted-foreground"}`,onClick:L,children:[e.jsx(U,{className:`w-5 h-5 ${p?"fill-current":""}`}),e.jsx("span",{className:"text-sm",children:t.likes_count||0})]}),e.jsxs(l,{variant:"ghost",size:"sm",className:"flex items-center gap-2 h-auto py-2 px-3 text-muted-foreground",children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:t.comments_count||0})]}),e.jsxs(l,{variant:"ghost",size:"sm",className:"flex items-center gap-2 h-auto py-2 px-3 text-muted-foreground",onClick:I,children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"Share"})]})]}),a&&t.creator_id===a.id&&e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs(l,{variant:"ghost",size:"sm",className:"flex items-center gap-2 h-auto py-2 px-3 text-muted-foreground hover:text-foreground",onClick:()=>o(`/creator/edit-post/${t.id}`),children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3Z"})}),e.jsx("span",{className:"text-sm",children:"Edit"})]}),e.jsxs(l,{variant:"ghost",size:"sm",className:"flex items-center gap-2 h-auto py-2 px-3 text-red-500 hover:text-red-600",onClick:async()=>{if(window.confirm("Are you sure you want to delete this post?"))try{if((await fetch(`/api/posts/${t.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)x({title:"Success",description:"Post deleted successfully"}),o("/creator/dashboard");else throw new Error("Failed to delete post")}catch{x({title:"Error",description:"Failed to delete post",variant:"destructive"})}},children:[e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 0 0 1-2-2V6h14Z"}),e.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),e.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]}),e.jsx("span",{className:"text-sm",children:"Delete"})]})]})]}),e.jsx(P,{postId:t.id.toString(),initialComments:[],onCommentCountChange:s=>b(r=>({...r,comments_count:s})),isBottomSheet:!1})]}),e.jsxs("div",{className:"w-70 space-y-0",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 px-2",children:"Up next"}),e.jsx("div",{className:"space-y-0 border border-border rounded-lg overflow-hidden",children:E.map((s,r)=>{const i=Array.isArray(s.media_urls)?s.media_urls[0]:s.media_urls,d=i!=null&&i.startsWith("http")?i:`/uploads/${i}`;return e.jsx("div",{className:`cursor-pointer hover:bg-muted/50 transition-colors ${r!==E.length-1?"border-b border-border":""}`,onClick:()=>V(s.id),children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"relative w-full aspect-video bg-black overflow-hidden mb-2 md:rounded-lg",children:[s.media_type==="video"?e.jsx("video",{src:d,className:"w-full h-full object-cover",muted:!0}):e.jsx("img",{src:d,alt:s.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(R,{className:"w-4 h-4 text-white",fill:"white"})}),s.duration&&e.jsxs("div",{className:"absolute bottom-1 right-1 bg-black text-white text-xs px-1 rounded",children:[Math.floor(s.duration/60),":",(s.duration%60).toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(N,{className:"h-9 w-9 flex-shrink-0",children:[e.jsx(v,{src:s.creator_avatar||s.avatar,alt:s.creator_username||s.username}),e.jsx(w,{className:"text-sm",children:(s.creator_display_name||s.creator_username||s.display_name||s.username||"U").charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-foreground line-clamp-2 mb-1",style:{fontSize:"14px",fontWeight:500},children:s.title||s.content}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground w-full",children:[e.jsx("span",{className:"truncate mr-2",children:s.creator_display_name||s.creator_username}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 text-right",children:[e.jsxs("span",{children:[s.views_count?s.views_count>=1e3?`${Math.floor(s.views_count/1e3)}K`:s.views_count:"0"," views"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:y(s.created_at)})]})]})]})]})]})},s.id)})})]})]})})})]})};export{ge as VideoWatch};
